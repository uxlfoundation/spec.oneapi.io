<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bandwidth Extension Properties &mdash; Level Zero Specification  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Level Zero Specification
          </a>
              <div class="version">
                1.4.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="INTRO.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="PROG.html">Core Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/PROG.html">Tools Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysman/PROG.html">Sysman Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPIRV.html">SPIR-V Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="EXT.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://spec.oneapi.io/releases/index.html#level-zero">Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Level Zero Specification</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">


  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="bandwidth-extension-properties">
<span id="ze-experimental-bandwidth-properties"></span><h1>Bandwidth Extension Properties<a class="headerlink" href="#bandwidth-extension-properties" title="Permalink to this headline"></a></h1>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Structures</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="api.html#ze-device-p2p-bandwidth-exp-properties-t"><span class="std std-ref">ze_device_p2p_bandwidth_exp_properties_t</span></a></p></li>
<li><p><a class="reference internal" href="api.html#ze-copy-bandwidth-exp-properties-t"><span class="std std-ref">ze_copy_bandwidth_exp_properties_t</span></a></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="bandwidth-properties">
<h3>Bandwidth Properties<a class="headerlink" href="#bandwidth-properties" title="Permalink to this headline"></a></h3>
<p>Properties of interest during data movement and remote access across various accelerators
interconnected via a set of fabrics include the bandwidths and latencies provided by the fabrics,
logical as well as physical, but also the bandwidths that can be driven by the various engines
present in the accelerators, i.e. the copy bandwidth. In order to saturate the interconnecting
fabrics, the copy bandwidth used to drive a transfer must be matched to the bandwidth provided by
the fabric. This may be achieved by utilizing one or more engines to drive the transfer. The
extensions provided here allow users to query both the fabric bandwidth &amp; latencies as well the
copy bandwidth provided by the various engines present on each accelerator.</p>
<p>Accelerators within a system may be connected using different link technologies as well as differing
numbers of links. Two accelerators may be logically but not physically connected to each other, meaning
that memory accesses and copies between the accelerators have to go over intervening accelerators.
This limits the maximum bandwidth to the lowest bandwidth link along the connection while increasing
the latency to the sum total of the latencies of the links along the connection. The net bandwidth and
latency for two logically connected accelerators accounts for link technology, number of links, number
of hops between the accelerators, etc… The net physical bandwidth &amp; physical latency between two
accelerators are zero unless the accelerators are directly connected to each other by a fabric, and
account for link technology, number of links, etc…</p>
<p>The following pseudo-code demonstrates a sequence for obtaining the p2p bandwidth &amp; latency between two devices:</p>
<pre class="literal-block">// devCount is the count of the number of devices in the system
uint32_t** bwTable
uint32_t** latTable

bwTable = (uint32_t**)allocate(devCount*sizeof(uint32_t*));
latTable = (uint32_t**)allocate(devCount*sizeof(uint32_t*));

<a class="reference internal" href="api.html#ze-device-p2p-properties-t"><span class="std std-ref">ze_device_p2p_properties_t</span></a> P2PProps;
<a class="reference internal" href="api.html#ze-device-p2p-bandwidth-exp-properties-t"><span class="std std-ref">ze_device_p2p_bandwidth_exp_properties_t</span></a> P2PBandwidthProps;
P2PProps.stype = ZE_STRUCTURE_TYPE_DEVICE_P2P_PROPERTIES
P2Props.pNext = &amp;P2PbandwidthProps;
P2PBandwidthProps = ZE_STRUCTURE_TYPE_DEVICE_P2P_BANDWIDTH_EXT_PROPERTIES;
P2PBandwidthProps = nullptr;

// Assume devices are stored in array called devices of size devCount
for (uint32_t dev = 0; dev &lt; devCount; ++dev) {
    bwTable[dev] = (uint32_t*)allocate(devCount*sizeof(uint32_t));
    latTable[dev] = (uint32_t*)allocate(devCount*sizeof(uint32_t));
    for (uint32_t peer_dev = 0; peer_dev &lt; devCount; ++peer_dev) {
        zeDeviceGetP2PProperties(devices[dev], devices[peer_dev], &amp;P2PProps);
        bwTable[dev][peer_dev] = P2PProps.pNext-&gt;logicalBandwidth;
        latTable[dev][peer_dev] = P2PProps.pNext-&gt;logicalLatency;
    }
}</pre>
<p>Engines from different command queue groups may drive differing amounts of bandwidth over the same link between two accelerators. The copy bandwidth of the engines within each command queue group is provided to help users determine which command queue group to pick the right types and numbers of engines from the accelerator for driving each copy operation given constraints such as the maximum bandwidth that a link supports, current usage of engines, etc… For example, some command queue groups that support copy may afford engines that support a higher copy bandwidth as compared to those from a different command queue group. For driving copies from local memory to local memory, it may be advisable to use an engine from a higher copy bandwidth group. For performing copies between devices interconnected with a lower bandwidth link, it may suffice to use an engine from a lower copy bandwidth group.</p>
<p>The following pseudo-code demonstrates a sequence for obtaining the copy bandwidth of the engines in each command queue group:</p>
<pre class="literal-block">// Discover all command queue groups
uint32_t cmdqueueGroupCount = 0;
<a class="reference internal" href="api.html#zedevicegetcommandqueuegroupproperties"><span class="std std-ref">zeDeviceGetCommandQueueGroupProperties</span></a>(hDevice, &amp;cmdqueueGroupCount, nullptr);

<a class="reference internal" href="api.html#ze-command-queue-group-properties-t"><span class="std std-ref">ze_command_queue_group_properties_t</span></a>* cmdqueueGroupProperties = (<a class="reference internal" href="api.html#ze-command-queue-group-properties-t"><span class="std std-ref">ze_command_queue_group_properties_t</span></a>*)
    allocate(cmdqueueGroupCount * sizeof(<a class="reference internal" href="api.html#ze-command-queue-group-properties-t"><span class="std std-ref">ze_command_queue_group_properties_t</span></a>));
<a class="reference internal" href="api.html#ze-copy-bandwidth-exp-properties-t"><span class="std std-ref">ze_copy_bandwidth_exp_properties_t</span></a>* cmdqueueGroupBandwidth = (<a class="reference internal" href="api.html#ze-copy-bandwidth-exp-properties-t"><span class="std std-ref">ze_copy_bandwidth_exp_properties_t</span></a>*)
        allocate(cmdqueueGroupCount * sizeof(<a class="reference internal" href="api.html#ze-copy-bandwidth-exp-properties-t"><span class="std std-ref">ze_copy_bandwidth_exp_properties_t</span></a>));
for( uint32_t i = 0; i &lt; cmdqueueGroupCount; ++i ) {
    cmdqueueGroupProperties[i].stype = ZE_STRUCTURE_TYPE_COMMAND_QUEUE_GROUP_PROPERTIES;
    cmdqueueGroupProperties[i].pNext = &amp;cmdqueueGroupBandwidth[i];
    cmdqueueGroupBandwidth[i].stype = ZE_STRUCTURE_TYPE_COPY_BANDWIDTH_EXT_PROPERTIES;
    cmdqueueGroupBandwidth[i].pNext = nullptr;
}
<a class="reference internal" href="api.html#zedevicegetcommandqueuegroupproperties"><span class="std std-ref">zeDeviceGetCommandQueueGroupProperties</span></a>(hDevice, &amp;cmdqueueGroupCount, cmdqueueGroupProperties);


// Find a command queue type that supports copy &amp; print the copy bandwidth
uint32_t computeQueueGroupOrdinal = cmdqueueGroupCount;
for( uint32_t i = 0; i &lt; cmdqueueGroupCount; ++i ) {
    if( cmdqueueGroupProperties[ i ].flags &amp; <a class="reference internal" href="api.html#ze-command-queue-group-property-flags-t"><span class="std std-ref">ZE_COMMAND_QUEUE_GROUP_PROPERTY_FLAG_COPY</span></a> ) {
        computeQueueGroupOrdinal = i;
        printf(&quot;copyBandwidth: %uln&quot;, cmdqueueGroupBandwidth[i].copyBandwidth)
        break;
    }
}

if(computeQueueGroupOrdinal == cmdqueueGroupCount)
    return; // no compute queues found</pre>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Intel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>